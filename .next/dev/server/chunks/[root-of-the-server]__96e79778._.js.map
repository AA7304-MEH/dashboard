{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///D:/linkedin%20content%20generator/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///D:/linkedin%20content%20generator/app/api/generate-comment/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport { auth, currentUser } from '@clerk/nextjs/server';\r\nimport { prisma } from '@/lib/prisma';\r\n\r\nconst genAI = new GoogleGenerativeAI(process.env.GOOGLE_GENERATIVE_AI_API_KEY || '');\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const { postContent, postAuthor } = await request.json();\r\n        const { userId } = await auth();\r\n        const user = await currentUser();\r\n\r\n        let userVoiceProfile = null;\r\n        let userStories = [];\r\n\r\n        // Fetch user voice profile if logged in to make comments sound authentic\r\n        if (userId && user) {\r\n            const dbUser = await prisma.user.findUnique({\r\n                where: { id: userId },\r\n            });\r\n\r\n            if (dbUser?.voiceProfile) {\r\n                try {\r\n                    const profile = JSON.parse(dbUser.voiceProfile);\r\n                    userVoiceProfile = profile;\r\n                    userStories = profile.stories || [];\r\n                } catch (e) {\r\n                    console.error(\"Error parsing voice profile\", e);\r\n                }\r\n            }\r\n        }\r\n\r\n        const model = genAI.getGenerativeModel({ model: \"gemini-2.0-flash\" });\r\n\r\n        // Pick a random story to potentially use in the 'story' comment option\r\n        const randomStory = userStories.length > 0 ? userStories[Math.floor(Math.random() * userStories.length)] : null;\r\n        const tone = userVoiceProfile?.tone || 'Professional';\r\n\r\n        const prompt = `Generate 3 smart, engaging LinkedIn comments for the following post by ${postAuthor || 'someone'}:\r\n    \r\n    Post: \"${postContent}\"\r\n\r\n    Your Persona Tone: ${tone}\r\n\r\n    Output JSON with 3 specific keys:\r\n    1. \"valueAdd\": A comment that adds a new insight, tip, or perspective to the post.\r\n    2. \"question\": A thoughtful question to spark discussion with the author.\r\n    3. \"story\": A comment that briefly relates a personal experience. ${randomStory ? `Try to weave in this story if relevant: ${randomStory.title} - ${randomStory.summary}` : 'Use a generic relatable professional experience.'}\r\n\r\n    Keep comments under 50 words. Sound human, not AI. No hashtags.\r\n    Return only valid JSON.`;\r\n\r\n        const result = await model.generateContent(prompt);\r\n        const response = await result.response;\r\n        let text = response.text();\r\n        text = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n\r\n        const data = JSON.parse(text);\r\n\r\n        return NextResponse.json(data);\r\n    } catch (error) {\r\n        console.error(\"Comment generation error:\", error);\r\n        return NextResponse.json(\r\n            { error: 'Failed to generate comments' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAAA;AACA;;;;;AAEA,MAAM,QAAQ,IAAI,sLAAkB,CAAC,+EAA4C;AAE1E,eAAe,KAAK,OAAgB;IACvC,IAAI;QACA,MAAM,EAAE,WAAW,EAAE,UAAU,EAAE,GAAG,MAAM,QAAQ,IAAI;QACtD,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAA,6LAAI;QAC7B,MAAM,OAAO,MAAM,IAAA,2MAAW;QAE9B,IAAI,mBAAmB;QACvB,IAAI,cAAc,EAAE;QAEpB,yEAAyE;QACzE,IAAI,UAAU,MAAM;YAChB,MAAM,SAAS,MAAM,yHAAM,CAAC,IAAI,CAAC,UAAU,CAAC;gBACxC,OAAO;oBAAE,IAAI;gBAAO;YACxB;YAEA,IAAI,QAAQ,cAAc;gBACtB,IAAI;oBACA,MAAM,UAAU,KAAK,KAAK,CAAC,OAAO,YAAY;oBAC9C,mBAAmB;oBACnB,cAAc,QAAQ,OAAO,IAAI,EAAE;gBACvC,EAAE,OAAO,GAAG;oBACR,QAAQ,KAAK,CAAC,+BAA+B;gBACjD;YACJ;QACJ;QAEA,MAAM,QAAQ,MAAM,kBAAkB,CAAC;YAAE,OAAO;QAAmB;QAEnE,uEAAuE;QACvE,MAAM,cAAc,YAAY,MAAM,GAAG,IAAI,WAAW,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,YAAY,MAAM,EAAE,GAAG;QAC3G,MAAM,OAAO,kBAAkB,QAAQ;QAEvC,MAAM,SAAS,CAAC,uEAAuE,EAAE,cAAc,UAAU;;WAE9G,EAAE,YAAY;;uBAEF,EAAE,KAAK;;;;;sEAKwC,EAAE,cAAc,CAAC,wCAAwC,EAAE,YAAY,KAAK,CAAC,GAAG,EAAE,YAAY,OAAO,EAAE,GAAG,mDAAmD;;;2BAGxM,CAAC;QAEpB,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;QAC3C,MAAM,WAAW,MAAM,OAAO,QAAQ;QACtC,IAAI,OAAO,SAAS,IAAI;QACxB,OAAO,KAAK,OAAO,CAAC,YAAY,IAAI,OAAO,CAAC,QAAQ,IAAI,IAAI;QAE5D,MAAM,OAAO,KAAK,KAAK,CAAC;QAExB,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC7B,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAA8B,GACvC;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}