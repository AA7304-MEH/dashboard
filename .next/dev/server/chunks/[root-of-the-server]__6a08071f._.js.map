{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///D:/linkedin%20content%20generator/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,6IAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///D:/linkedin%20content%20generator/app/api/generate/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { GoogleGenerativeAI } from '@google/generative-ai';\r\nimport { auth, currentUser } from '@clerk/nextjs/server';\r\nimport { prisma } from '@/lib/prisma';\r\n\r\nconst genAI = new GoogleGenerativeAI(process.env.GOOGLE_GENERATIVE_AI_API_KEY || '');\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const { topic, tone, type, length, includeHook, includeStory } = await request.json();\r\n        const { userId } = await auth();\r\n        const user = await currentUser();\r\n\r\n        let userVoiceProfile = null;\r\n        let userStories = [];\r\n        let userPerspective = '';\r\n\r\n        if (userId && user) {\r\n            const email = user.emailAddresses[0]?.emailAddress;\r\n            if (email) {\r\n                await prisma.user.upsert({\r\n                    where: { id: userId },\r\n                    update: {},\r\n                    create: { id: userId, email },\r\n                });\r\n            }\r\n\r\n            const dbUser = await prisma.user.findUnique({\r\n                where: { id: userId },\r\n            });\r\n\r\n            if (dbUser?.voiceProfile) {\r\n                try {\r\n                    const profile = JSON.parse(dbUser.voiceProfile);\r\n                    userVoiceProfile = profile;\r\n                    userStories = profile.stories || [];\r\n                    userPerspective = profile.perspective || '';\r\n                } catch (e) {\r\n                    console.error(\"Error parsing voice profile\", e);\r\n                }\r\n            }\r\n        }\r\n\r\n        const model = genAI.getGenerativeModel({ model: \"gemini-1.5-flash\" });\r\n\r\n        let prompt = `Generate a LinkedIn post about \"${topic}\".\r\n        \r\n        Parameters:\r\n        - Tone: ${tone || (userVoiceProfile ? userVoiceProfile.tone : 'Professional')}\r\n        - Type: ${type || 'Educational'}\r\n        - Length: ${length || 'Medium'}\r\n        `;\r\n\r\n        if (userPerspective) {\r\n            prompt += `\\n- Incorporate this unique perspective/philosophy: \"${userPerspective}\"`;\r\n        }\r\n\r\n        if (includeStory && userStories.length > 0) {\r\n            const randomStory = userStories[Math.floor(Math.random() * userStories.length)];\r\n            prompt += `\\n- Weave in this personal story: \"${randomStory.title} - ${randomStory.summary}\"`;\r\n        }\r\n\r\n        if (includeHook) {\r\n            prompt += `\\n- Start with a viral-style hook (curiosity gap or strong statement).`;\r\n        } else {\r\n            prompt += `\\n- Start with a clear professional opening.`;\r\n        }\r\n\r\n        prompt += `\\n\\nReturn the output in the following JSON format (no markdown):\r\n        {\r\n            \"content\": \"The full post content...\",\r\n            \"hashtags\": {\r\n                \"broad\": [\"#tag1\", \"#tag2\"],\r\n                \"niche\": [\"#tag3\", \"#tag4\"],\r\n                \"community\": [\"#tag5\", \"#tag6\"]\r\n            }\r\n        }\r\n        \r\n        Hashtag Strategy:\r\n        - Broad: High volume tags (e.g. #marketing)\r\n        - Niche: Specific to the topic (e.g. #seo)\r\n        - Community: Specific groups (e.g. #marketers)\r\n        `;\r\n\r\n        const result = await model.generateContent(prompt);\r\n        const response = await result.response;\r\n        let text = response.text();\r\n\r\n        // Clean markdown if present\r\n        text = text.replace(/```json/g, '').replace(/```/g, '').trim();\r\n\r\n        let data;\r\n        try {\r\n            data = JSON.parse(text);\r\n        } catch (e) {\r\n            // Fallback if JSON parsing fails\r\n            data = { content: text, hashtags: { broad: [], niche: [], community: [] } };\r\n        }\r\n\r\n        // Save to DB if user is logged in\r\n        if (userId) {\r\n            await prisma.post.create({\r\n                data: {\r\n                    content: data.content,\r\n                    tone: tone || (userVoiceProfile ? userVoiceProfile.tone : 'Professional'),\r\n                    type: type || 'Educational',\r\n                    userId: userId,\r\n                },\r\n            });\r\n        }\r\n\r\n        return NextResponse.json(data);\r\n    } catch (error) {\r\n        console.error(\"Generation error:\", error);\r\n\r\n        // Temporary debugging\r\n        try {\r\n            const fs = require('fs');\r\n            const path = require('path');\r\n            const logPath = path.join(process.cwd(), 'debug_error.log');\r\n            const errorMessage = error instanceof Error ? error.message + '\\n' + error.stack : String(error);\r\n            fs.appendFileSync(logPath, `\\n\\n[${new Date().toISOString()}] Error:\\n${errorMessage}\\n`);\r\n        } catch (e) { }\r\n\r\n        return NextResponse.json(\r\n            { error: 'Failed to generate content' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}